name: CI - PR Validation

permissions:
    contents: read

on:
    pull_request:
        branches: ["**"]

    workflow_dispatch:

jobs:
    linux-gcc:
        uses: ./.github/workflows/build-linux-gcc.yml

    linux-clang:
        uses: ./.github/workflows/build-linux-clang.yml

    macos-clang:
        uses: ./.github/workflows/build-macos-clang.yml

    windows-msvc:
        uses: ./.github/workflows/build-windows-msvc.yml

    windows-clang-cl:
        uses: ./.github/workflows/build-windows-clang-cl.yml

    windows-mingw:
        uses: ./.github/workflows/build-windows-mingw.yml

    pr_verification_summary:
        needs:
            - linux-gcc
            - linux-clang
            - macos-clang
            - windows-msvc
            - windows-clang-cl
            - windows-mingw
        runs-on: ubuntu-latest
        if: always()
        steps:
            - name: Check if all jobs succeeded
              run: |
                  if [[ "${{ needs.linux-gcc.result }}" != "success" || \
                        "${{ needs.linux-clang.result }}" != "success" || \
                        "${{ needs.macos-clang.result }}" != "success" || \
                        "${{ needs.windows-msvc.result }}" != "success" || \
                        "${{ needs.windows-clang-cl.result }}" != "success" || \
                        "${{ needs.windows-mingw.result }}" != "success" ]]; then
                      echo "One or more jobs failed"
                      exit 1
                  fi
                  echo "All jobs completed successfully"
